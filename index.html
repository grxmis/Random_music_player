<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Τυχαίος Αναπαραγωγέας Μουσικής</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#9aa6b2;--accent:#4fd1c5}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; background:linear-gradient(180deg,#071426,#0b1220); color:#e6eef6; min-height:100vh; margin:0; display:flex; align-items:center; justify-content:center}
    .app{width:940px; max-width:96%; background:rgba(255,255,255,0.03); border-radius:12px; padding:20px; box-shadow:0 10px 30px rgba(2,6,23,0.6)}
    h1{margin:0 0 12px 0; font-size:20px}
    .controls{display:flex; gap:8px; align-items:center; margin-bottom:12px}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:10px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.04);color:inherit;cursor:pointer;font-weight:600}
    .btn:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(2,6,23,0.5)}
    .btn.primary{background:linear-gradient(90deg,var(--accent),#2dd4bf); color:#022; border:none}
    .btn svg{width:18px;height:18px;display:block}
    .btn .state{font-size:12px;color:var(--muted);margin-left:6px}

    .file-drop{border:2px dashed rgba(255,255,255,0.04); padding:16px; border-radius:8px; text-align:center; color:var(--muted); margin-bottom:12px}
    .playlist{max-height:220px; overflow:auto; border-top:1px solid rgba(255,255,255,0.03); padding-top:8px}
    .track{display:flex; justify-content:space-between; align-items:center; padding:8px; border-radius:6px}
    .track.active{background:linear-gradient(90deg, rgba(79,209,197,0.08), rgba(79,209,197,0.02));}
    .track .title{flex:1; margin-right:8px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    .progress{width:100%; height:6px; background:rgba(255,255,255,0.04); border-radius:6px; overflow:hidden; margin:10px 0}
    .progress > b{display:block; height:100%; width:0%; background:linear-gradient(90deg,var(--accent),#2dd4bf)}
    .small{font-size:13px; color:var(--muted)}
    .footer{display:flex; justify-content:space-between; align-items:center; gap:12px; margin-top:12px}
    input[type=file]{display:none}
    #clearBtn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:6px 10px;border-radius:8px;color:inherit;cursor:pointer}
  </style>
</head>
<body>
  <div class="app">
    <h1>Τυχαίος Αναπαραγωγέας Μουσικής</h1>
    <div class="controls">
      <label class="btn primary" id="addFilesBtn" title="Προσθήκη τραγουδιών">➕ Προσθήκη αρχείων</label>
      <button class="btn" id="shuffleBtn" title="Ανάμειξη/Shuffle"><span id="shuffleIcon"></span> <span id="shuffleState" class="state">ON</span></button>
      <button class="btn" id="loopBtn" title="Επανάληψη τρέχοντος"><span id="loopIcon"></span> <span id="loopState" class="state">OFF</span></button>
      <div style="flex:1"></div>
      <button class="btn" id="prevBtn" title="Previous"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11 12L20 18V6L11 12Z" fill="currentColor"/><path d="M4 6V18H6V6H4Z" fill="currentColor"/></svg></button>
      <button class="btn" id="playBtn" title="Play/Pause"></button>
      <button class="btn" id="nextBtn" title="Next"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 6L13 12L4 18V6Z" fill="currentColor"/><path d="M16 6H18V18H16V6Z" fill="currentColor"/></svg></button>
      <button class="btn" id="stopBtn" title="Stop"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="6" y="6" width="12" height="12" fill="currentColor"/></svg></button>
      <label class="small" id="countLabel">0 τραγούδια</label>
    </div>

    <div id="dropArea" class="file-drop">Σύρε τα μουσικά αρχεία εδώ ή πάτησε "Προσθήκη αρχείων". Υποστηρίζονται: mp3, m4a, wav, ogg.</div>
    <input id="fileInput" type="file" multiple accept="audio/*">

    <div id="nowPlaying" style="margin:8px 0;font-weight:bold;font-size:16px"></div>

    <div class="progress" title="Πρόοδος αναπαραγωγής"><b id="progressBar"></b></div>
    <div class="small" id="timeLabel">00:00 / 00:00</div>

    <div class="playlist" id="playlist"></div>

    <div class="footer">
      <div class="small">Σημείωση: Τα αρχεία παίζονται τοπικά — τα δεν αποστέλλονται πουθενά.</div>
      <div>
        <button id="clearBtn">Καθαρισμός λίστας</button>
      </div>
    </div>

    <audio id="player" preload="metadata"></audio>
  </div>

  <script>
    // Elements
    const fileInput = document.getElementById('fileInput');
    const addFilesBtn = document.getElementById('addFilesBtn');
    const dropArea = document.getElementById('dropArea');
    const playlistEl = document.getElementById('playlist');
    const player = document.getElementById('player');
    const playBtn = document.getElementById('playBtn');
    const nextBtn = document.getElementById('nextBtn');
    const prevBtn = document.getElementById('prevBtn');
    const stopBtn = document.getElementById('stopBtn');
    const shuffleBtn = document.getElementById('shuffleBtn');
    const loopBtn = document.getElementById('loopBtn');
    const shuffleState = document.getElementById('shuffleState');
    const loopState = document.getElementById('loopState');
    const progressBar = document.getElementById('progressBar');
    const timeLabel = document.getElementById('timeLabel');
    const countLabel = document.getElementById('countLabel');
    const clearBtn = document.getElementById('clearBtn');

    // State
    let tracks = []; // {file, url, name}
    let currentIndex = -1;
    let isPlaying = false;
    let shuffle = true;
    let loop = false;

    // Helpers
    function formatTime(sec){
      if (!isFinite(sec)) return '00:00';
      const s = Math.floor(sec % 60).toString().padStart(2,'0');
      const m = Math.floor(sec/60).toString().padStart(2,'0');
      return `${m}:${s}`;
    }

    function updateCount(){
      countLabel.textContent = `${tracks.length} τραγούδια`;
    }

    function renderPlaylist(){
      playlistEl.innerHTML = '';
      tracks.forEach((t,i)=>{
        const div = document.createElement('div');
        div.className = 'track' + (i===currentIndex? ' active':'');
        div.innerHTML = `<div class="title">${i+1}. ${escapeHtml(t.name)}</div><div><button data-i="${i}">▶</button></div>`;
        playlistEl.appendChild(div);
        div.querySelector('button').addEventListener('click', ()=>{ playIndex(i); });
      });
    }

    function escapeHtml(s){ return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

    function addFiles(fileList){
      const supported = ['audio/mpeg','audio/mp3','audio/x-m4a','audio/m4a','audio/wav','audio/ogg','audio/x-wav'];
      for (const f of fileList){
        // accept most audio types; we will still try to play unknown ones
        const url = URL.createObjectURL(f);
        tracks.push({file:f, url, name: f.name});
      }
      updateCount();
      renderPlaylist();
      if (currentIndex === -1 && tracks.length) playIndex( Math.floor(Math.random()*tracks.length) );
    }

    // SVG icons (global for updateUI)
    const PLAY_SVG = '<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8 5v14l11-7z" fill="currentColor"/></svg>';
    const PAUSE_SVG = '<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M6 5h4v14H6zM14 5h4v14h-4z" fill="currentColor"/></svg>';
    const NEXT_SVG = '<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 6l9 6-9 6V6zm12 0h2v12h-2V6z" fill="currentColor"/></svg>';
    const PREV_SVG = '<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 6l-9 6 9 6V6zm-12 0H6v12h2V6z" fill="currentColor"/></svg>';
    const STOP_SVG = '<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><rect x="6" y="6" width="12" height="12" fill="currentColor"/></svg>';
    const SHUFFLE_SVG = '<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M16 3h5v5" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><path d="M4 6h3a5 5 0 0 1 4 2l3 4" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><path d="M4 18h3a5 5 0 0 0 4-2l3-4" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>';
    const LOOP_SVG = '<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21 12a9 9 0 1 0-9 9" stroke="currentColor" stroke-width="1.6" fill="none" stroke-linecap="round" stroke-linejoin="round"/><path d="M21 12v4h-4" stroke="currentColor" stroke-width="1.6" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>';

    // Playback
    function playIndex(i){
      if (i<0 || i>=tracks.length) return stopPlayback();
      currentIndex = i;
      const track = tracks[i];
      document.getElementById('nowPlaying').textContent = 'Τώρα παίζει: ' + track.name;
      player.src = track.url;
      player.play();
      isPlaying = true;
      updateUI();
      renderPlaylist();
    }

    function playNext(){
      if (tracks.length===0) return;
      if (loop){ player.currentTime = 0; player.play(); return; }
      if (shuffle){
        let next = Math.floor(Math.random()*tracks.length);
        if (tracks.length>1){ while (next === currentIndex) next = Math.floor(Math.random()*tracks.length); }
        playIndex(next);
      } else {
        const next = (currentIndex + 1) % tracks.length;
        playIndex(next);
      }
    }

    function playPrev(){
      if (tracks.length===0) return;
      if (player.currentTime > 3) { player.currentTime = 0; player.play(); return; }
      if (!shuffle){
        const prev = (currentIndex - 1 + tracks.length) % tracks.length;
        playIndex(prev);
      } else {
        playIndex( Math.floor(Math.random()*tracks.length) );
      }
    }

    function stopPlayback(){ player.pause(); player.removeAttribute('src'); player.load(); isPlaying=false; currentIndex=-1; updateUI(); renderPlaylist(); document.getElementById('nowPlaying').textContent = ''; }

    // UI update function
    function updateUI(){
      // main play/pause icon
      playBtn.innerHTML = isPlaying ? PAUSE_SVG : PLAY_SVG;
      prevBtn.innerHTML = PREV_SVG;
      nextBtn.innerHTML = NEXT_SVG;
      stopBtn.innerHTML = STOP_SVG;
      // shuffle & loop with small state label
      shuffleBtn.innerHTML = SHUFFLE_SVG + ' <span class="state">' + (shuffle? 'ON' : 'OFF') + '</span>';
      loopBtn.innerHTML = LOOP_SVG + ' <span class="state">' + (loop? 'ON' : 'OFF') + '</span>';
      // count
      updateCount();
    }

    // Events
    addFilesBtn.addEventListener('click', ()=> fileInput.click());
    fileInput.addEventListener('change', (e)=> addFiles(e.target.files));

    // Drag/drop
    ['dragenter','dragover'].forEach(ev=> dropArea.addEventListener(ev,(e)=>{ e.preventDefault(); dropArea.style.borderColor = 'rgba(79,209,197,0.6)'; }));
    ['dragleave','drop'].forEach(ev=> dropArea.addEventListener(ev,(e)=>{ e.preventDefault(); dropArea.style.borderColor = ''; }));
    dropArea.addEventListener('drop', (e)=>{ addFiles(e.dataTransfer.files); });

    playBtn.addEventListener('click', ()=>{
      if (!isPlaying){
        if (currentIndex===-1 && tracks.length){ playIndex( Math.floor(Math.random()*tracks.length) ); }
        else { player.play(); isPlaying=true; updateUI(); }
      } else { player.pause(); isPlaying=false; updateUI(); }
    });

    nextBtn.addEventListener('click', ()=> playNext());
    prevBtn.addEventListener('click', ()=> playPrev());
    stopBtn.addEventListener('click', ()=> stopPlayback());

    shuffleBtn.addEventListener('click', ()=>{ shuffle = !shuffle; updateUI(); });
    loopBtn.addEventListener('click', ()=>{ loop = !loop; updateUI(); });

    clearBtn.addEventListener('click', ()=>{
      // revoke object URLs
      tracks.forEach(t=> URL.revokeObjectURL(t.url));
      tracks = []; currentIndex=-1; player.pause(); player.removeAttribute('src'); player.load(); renderPlaylist(); updateCount(); updateUI();
    });

    // Player updates
    player.addEventListener('timeupdate', ()=>{
      const p = (player.currentTime / player.duration) || 0;
      progressBar.style.width = (p*100)+'%';
      timeLabel.textContent = `${formatTime(player.currentTime)} / ${formatTime(player.duration)}`;
    });

    player.addEventListener('ended', ()=>{
      playNext();
    });

    player.addEventListener('play', ()=>{ isPlaying=true; updateUI(); });
    player.addEventListener('pause', ()=>{ isPlaying=false; updateUI(); });

    // click on progress bar to seek
    document.querySelector('.progress').addEventListener('click', (e)=>{
      if (!player.duration) return;
      const rect = e.currentTarget.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const pct = x / rect.width;
      player.currentTime = pct * player.duration;
    });

    // keyboard shortcuts: space play/pause, n next, p prev
    window.addEventListener('keydown', (e)=>{
      if (e.code === 'Space'){ e.preventDefault(); playBtn.click(); }
      if (e.key.toLowerCase() === 'n') nextBtn.click();
      if (e.key.toLowerCase() === 'p') prevBtn.click();
    });

    // initial UI
    updateUI();

    // clean up object URLs when leaving
    window.addEventListener('unload', ()=>{ tracks.forEach(t=> URL.revokeObjectURL(t.url)); });
  </script>
</body>
</html>
